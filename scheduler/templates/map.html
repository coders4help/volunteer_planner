<div class="row">
    <div id="map" style="width: 100%; height: 400px; background: white"></div>
</div>
<script type="text/javascript" charset="UTF-8" >
    function createInfoText(name, street, city, postalCode) {
        var html = "<div class='map-marker-info'>";
        html = html + "<h3>" + name + "</h3>";
        html = html + "<p>" + street + "<br/>" + postalCode + " " + city + "</p>"
        html = html + "</div>";

        return html;
    }

    function createMarkersGroup() {
        markers = new Array();
        {% for location in locations %}
            {% if location.latitude and location.longitude %}
                var marker = new H.map.Marker({lat: {{ location.latitude }}, lng: {{location.longitude}} });
                marker.setData(createInfoText("{{ location.name }}", "{{ location.street }}", "{{ location.postal_code }}", "{{ location.city }}"));
                markers.push(marker);
            {% endif %}
        {% endfor %}

        group = new H.map.Group();

        // add 'tap' event listener, that opens info bubble, to the group
        group.addEventListener('tap', function (evt) {
            // event target is the marker itself, group is a parent event target
            // for all objects that it contains
            var bubble =  new H.ui.InfoBubble(evt.target.getPosition(), {
                // read custom data
                content: evt.target.getData()
            });
            // show info bubble
            ui.addBubble(bubble);
        }, false);

        group.addObjects(markers);
        return group;
    }

    function centerMapInBerlin(map) {
        map.setCenter({lat:52.5159, lng:13.3777});
        map.setZoom(14);
    }

    /**
    * Boilerplate map initialization code starts below:
     */

    //Step 1: initialize communication with the platform
    var platform = new H.service.Platform({
        app_id: 'mZIEtVjJGeugdntBBM7B',
        app_code: 'QyYAEUpGd0Nt0DDfh94YAA',
        useCIT: true,
        useHTTPS: true
    });
    var defaultLayers = platform.createDefaultLayers();

    //Step 2: initialize a map
    var map = new H.Map(document.getElementById('map'), defaultLayers.normal.map);

    //Step 3: make the map interactive
    // MapEvents enables the event system
    // Behavior implements default interactions for pan/zoom (also on mobile touch environments)
    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

    // Create the default UI components
    var ui = H.ui.UI.createDefault(map, defaultLayers);

    // Now use the map as required...
    markersGroup = createMarkersGroup();
    map.addObject(markersGroup);
    if (markersGroup.getObjects().length == 0) {
        // no location is given: just show the map of Berlin without any markers
        centerMapInBerlin(map);
    } else {
        // expand the map in a way that all markers are shown on the map
        map.setViewBounds(group.getBounds());

        if (markersGroup.getObjects().length == 1) {
            // reset the zoom level in case there's only one marker
            // otherwise, the zoom level would be too high
            map.setZoom(15);
        }
    }
</script>