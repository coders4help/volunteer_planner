{% extends "base.html" %}


{% block html_attributes %} ng-app="vpWidgets"{% endblock %}

{% block additional_js %}
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.4/ui-bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.4/ui-bootstrap-tpls.min.js"></script>
    <script>
        angular.module('vpWidgets', ['ui.bootstrap'])
                .controller('ShiftWidgetCtrl', function($scope) {
                    // this rather should be done through an nice REST api
                    $scope.locations = {{ location_json | safe }};
                    $scope.places = {{ places_json | safe }};
                    $scope.selectedPlaces = [];
                });

    </script>

{% endblock %}

{% load google_links i18n %}
{% block content %}
    {% if notifications %}
        <div class="row">
            <h2>{% trans "Important news" %}</h2>
            {% for notification in notifications %}
                <div>
                    <h3>{{ notification.title }}</h3>
                    <h4>
                        {% blocktrans trimmed with location_name=notification.location.name date=notification.creation_date %}
                            {{ location_name }} on {{ date }}
                        {% endblocktrans %}
                    </h4>
                    {{ notification.text|safe }}
                </div>
            {% endfor %}
        </div>
        <hr/>
    {% endif %}
        <div class="places-filter row" ng-controller="ShiftWidgetCtrl">
            <h2>{% trans "Volunteers wanted" %}</h2>
            {% verbatim %}
                <div class="col-md12">
                    <button type="button"
                            ng-repeat="place in places"
                            class="btn btn-default btn-sm"
                            ng-click="selectedPlaces[place.slug] = !selectedPlaces[place.slug]"
                            ng-class="{ 'btn-primary': selectedPlaces[place.slug] }"
                            >{{ place.name }}</button>
                </div>
                <div class="places-accordions row">
                    <div class="col-md-12">
                        <div ng-repeat="location in locations" ng-show="selectedPlaces[location.place_slug]">
                            <accordion>
                                <accordion-group panel-class="panel-primary">
                                    <accordion-heading>
                                        {{ location.name }}
                                    </accordion-heading>
                                    <div class="col-md-12">
                                        <div class="col-md-8">
                                            <h5>
                                                {{ location.address_line }}
                                                <a target="_blank" ng-href="{{ location.google_maps_link }}">â†’ Google Maps</a>
                                            </h5>
                                            <p>{{ location.additional_info }}</p>
                                        </div>
                                        <div class="col-md-4">
                                            {% endverbatim %}<h4>{% trans "open shifts" %}</h4>{% verbatim %}
                                            <p>
                                                <span ng-repeat="shift in location.shifts">
                                                    <a ng-href="{{ shift.link }}">{{ shift.date_string }}</a>
                                                    <br>
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </accordion-group>
                            </accordion>
                        </div>
                    </div>
                </div>
            {% endverbatim %}
        </div>
{% endblock %}
